.label Teacher Books
h4 = @teacher.name

ul#teacher-options.dropdown-content
  li  
  - @teachers.all.each do |teacher|
    li 
      = link_to teacher.name, employee_book_loans_path(teacher,year:@academic_year.id)
ul#year-options.dropdown-content
  li  
    = link_to 'All', employee_book_loans_path(params.merge(year:'all').symbolize_keys)
  - AcademicYear.list_for_menu.each do |year|
    li 
      = link_to year.name, employee_book_loans_path(params.merge(year:year.id).symbolize_keys)
// NOTE: for these wierd .symbolize_keys, refer to this article https://github.com/rails/rails/issues/21645
ul#checked-options.dropdown-content
  li 
    = link_to 'All', employee_book_loans_path
  li
    = link_to 'Yes', employee_book_loans_path(checked:'t')
  li
    = link_to 'No', employee_book_loans_path(checked:'f')
    
nav
  .nav-wrapper
    ul
      li
        a.dropdown-button href="#!" data-activates="teacher-options"
          span#teacher = @teacher.present? ? "#{@teacher.name}" : "Teacher name" 
          i.material-icons.right arrow_drop_down
      li
        a.dropdown-button href="#!" data-activates="year-options"
          span#year = @academic_year.present? ? "#{@academic_year.name}" : "Academic Year" 
          i.material-icons.right arrow_drop_down
    ul.right
      li 
        -if @academic_year.present?
          = link_to employee_book_loans_path(@teacher, year: @academic_year.id, format: :pdf), target: '_blank'
            | PDF
            i.material-icons.left description
        - else
          = link_to employee_book_loans_path(@teacher, format: :pdf), target: '_blank'
            | PDF
            i.material-icons.left description
      li
        = link_to scan_employee_book_loans_path(@teacher)
          | Scan
          i.material-icons.left import_contacts
      - if can? :manage, BookLoan
        li
          = link_to new_employee_book_loans_path(@teacher)
            | Add
            i.material-icons.left add
              
#show-modal.modal.modal-fixed-footer

.card-panel
  - unless @error.present?
    table.compact.striped
      thead
        tr
          th No
          th Barcode
          th Book title
          th Out date
          th Return date
          th
            a.dropdown-button href="#!" data-activates="checked-options" data-beloworigin="true" 
              | Checked?
              i.material-icons.left arrow_drop_down          
          th Actions
            
      tbody
        - @book_loans.each_with_index do |book_loan, i|
          tr id="row-#{book_loan.id}"
            td = @book_loans.offset + i + 1
            td = link_to book_loan.barcode, book_loan.book_copy
            td 
              - if book_loan.book_edition.present?
                = link_to book_loan.book_edition.try(:title).truncate(50), book_loan.book_edition, remote: true
            td = book_loan.out_date
            td = book_loan.return_date
            td style='text-align:center' = book_loan.return_status == 'R' ? '&#9745;'.html_safe : ''
            td 
              = link_to employee_book_loan_path(employee_id: @teacher.id, id:book_loan.id), remote:true
                i.material-icons visibility
              - if can? :delete, BookLoan
                = link_to book_loan, data: {id: book_loan.id, confirm: 'Are you sure?'}, :method => :delete, class:"red-text delete-link", remote: true
                  i.material-icons delete
  - else 
    = @error

.toolbar.z-depth-1
  = will_paginate @book_titles
  
javascript:
  $('.delete-link').bind('ajax:complete', function() {
    var id = $(this).data("id");
    $("tr#row-"+id).remove();
    Materialize.toast("Book Loan record deleted", 4000, "green");
  });
